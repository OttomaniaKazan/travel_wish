# Бот-записная книжка путешественника: Спецификация проекта

## 1. Концепция продукта

Бот для Телеграм, позволяющий пользователям сохранять желания посетить достопримечательности и отслеживать их реализацию. Основная ценность — превращение спонтанных впечатлений («хочу посетить музей Айвазовского») в структурированный список с возможностью последующего анализа и планирования.

Ключевые принципы:
- Минимизация барьеров для ввода: пользователь не должен помнить точные названия или даты
- Нормализация данных для корректной статистики
- Акцент на интересе к месту, а не на жёстком планировании поездок
- Полная приватность персональных данных пользователя

## 2. Архитектура данных

### 2.1. Нормализация объектов

Каждый объект (город, достопримечательность) имеет:
- Каноническое название — единый стандартный вариант для аналитики
- Список алиасов — все возможные варианты ввода пользователей («третьяковка», «третьяковская галерея»)
- Привязку к родительскому объекту (достопримечательность → город → страна)

Пример структуры:
```
Город: Москва (страна: Россия)
  └─ Достопримечательность: Государственная Третьяковская галерея
        Алиасы: третьяковка, третьяковская, гтг

Город: Казань (страна: Россия)
  └─ Достопримечательность: Казанский Кремль
        Алиасы: кремль, казанский кремль
```

Решение неоднозначности («Кремль» в Москве/Казани):
- Достопримечательность идентифицируется парой (название + город)
- При вводе без указания города — обязательный запрос уточнения у пользователя
- Город проживания пользователя НЕ используется как значение по умолчанию (противоречит логике путешествий)

### 2.2. Структура базы данных

Основные сущности:
- `users` — пользователи (идентификатор, дата регистрации)
- `countries` — страны (каноническое название)
- `cities` — города (каноническое название, привязка к стране, население)
- `city_aliases` — алиасы городов (для поиска)
- `places` — достопримечательности (каноническое название, привязка к городу)
- `place_aliases` — алиасы достопримечательностей
- `user_wishes` — желания пользователей:
  - user_id, place_id, city_id (для быстрого поиска)
  - status: pending / visited
  - visited_month, visited_year (опционально, только при подтверждении пользователем)
  - created_at (дата добавления желания — обязательно)

### 2.3. Узкие места и решения

| Проблема | Решение |
|----------|---------|
| Неоднозначность городов (Минск Беларусь / Минск РФ) | Привязка города к стране; при поиске показывать полное название «Минск (Беларусь)» |
| Одинаковые названия достопримечательностей | Идентификация парой (место + город); при неопределённости — запрос уточнения |
| Опечатки и варианты написания | Автодополнение при выборе города/места; алиасы для популярных опечаток |
| Дублирование записей | Проверка перед добавлением: (user_id + place_id + status=pending) |
| Закрытые/переименованные объекты | Поле `is_active` в таблицах городов и мест; уведомление при открытии неактивной записи |

## 3. Пользовательский интерфейс

### 3.1. Добавление желания

Пошаговый диалог с автодополнением:
1. Выбор города через поиск с автодополнением (набрал «каз» → показаны варианты: Казань, Казахстан)
2. Выбор достопримечательности (с фильтрацией по выбранному городу)
3. Подтверждение добавления

Преимущества автодополнения:
- 100% точность привязки к каноническому объекту
- Отсутствие опечаток
- Ускорение ввода (3–4 символа вместо полного названия)
- Единая база для корректной статистики

### 3.2. Работа со списками и статусами

Иерархическая навигация:
```
Мои планы → Список городов → Выбор города → Список мест в городе
```

Два режима отметки посещения:
- Отметить отдельные места: пользователь выбирает конкретные объекты, указывает месяц посещения (опционально)
- Отметить весь город: подтверждение с предупреждением о количестве затронутых мест

Статус города вычисляется динамически:
- Полностью посещён: 100% мест со статусом «посетил»
- Частично посещён: от 1% до 99%
- Не посещён: 0% посещённых мест

### 3.3. Дата посещения

- Точная дата НЕ запрашивается — создаёт барьер для пользователя
- Месяц и год посещения — опциональны, запрашиваются только при отметке статуса «посетил»
- По умолчанию предлагается текущий месяц с пометкой «примерно»
- Достаточно для анализа сезонных трендов без перегрузки пользователя

## 4. Статистика и аналитика

### 4.1. Персональная статистика пользователя
- Количество посещённых/непосещённых мест по городам
- Сезонные тренды (посещения по месяцам)
- Прогресс по регионам («Вы посетили 7 из 12 мест в Москве»)

### 4.2. Агрегированная статистика (анонимизированная)
- Популярность достопримечательностей по городам
- Сезонные тренды интереса («Июль — пик интереса к Казани»)
- Динамика спроса на направления

Важно: агрегированная статистика формируется только при соблюдении k-anonymity (минимум 50 пользователей в выборке) для исключения возможности идентификации личности.

## 5. Монетизация

### 5.1. Здоровая стратегия (поэтапная)

**Этап 1: MVP (0–500 пользователей)**
- Монетизация отсутствует
- Фокус: проверка ценности продукта, сбор фидбека, улучшение UX

**Этап 2: Рост (500–5 000 пользователей)**
- Премиум-подписка (99–199 ₽/мес):
  - Неограниченное количество записей (бесплатно — до 20)
  - Экспорт в PDF/Google Maps
  - Фотографии и заметки к местам
  - Автоматические напоминания о нереализованных желаниях
- Партнёрские программы:
  - Бронирование отелей (Островок.ру, Яндекс.Путешествия)
  - Страховки (Сравни.ру)
  - Экскурсии (Трипстер)
  - Комиссия: 3–7% от суммы бронирования

**Этап 3: Масштаб (5 000+ пользователей)**
- Продажа анонимизированной аналитики туроператорам:
  - Отчёты «Туристический барометр» по регионам и сезонам
  - Анализ спроса на новые направления
  - Требует юридической экспертизы по ФЗ-152 и внедрения k-anonymity
- B2B-интеграции:
  - Корпоративные аккаунты для компаний (бонус сотрудникам)
  - Интеграция с CRM турфирм для генерации лидов

### 5.2. Этические ограничения

Запрещено:
- Продажа персональных данных (ФЗ-152)
- Реклама в каждом сообщении (разрушает UX)
- Автоматическая отметка мест без подтверждения пользователя
- Использование данных без явного согласия в пользовательском соглашении

Разрешено:
- Агрегированная аналитика с соблюдением анонимности
- Ненавязчивые партнёрские предложения по запросу пользователя
- Премиум-функции, улучшающие базовый опыт

## 6. Технические ресурсы

### 6.1. Источники данных

Города и страны:
- GeoNames (бесплатная база 250 000+ городов с координатами и населением)
- Викиданные (многоязычные алиасы)

Достопримечательности:
- Википедия (координаты, описания)
- OpenStreetMap (туристические объекты)
- Ручное наполнение на старте (топ-100 городов России и СНГ)

### 6.2. Технологический стек

- Язык: Python 3.10+
- Фреймворк бота: aiogram 3.x
- База данных:
  - MVP: SQLite (локальное хранение)
  - Масштаб: PostgreSQL (облачное размещение)
- ORM: SQLAlchemy (для нормализованной структуры)
- Хостинг: Railway / Yandex Cloud Functions (бессерверная архитектура)

### 6.3. Юридические аспекты

- Пользовательское соглашение с явным указанием:
  - Какие данные собираются
  - Как используются анонимизированные данные для аналитики
  - Право пользователя на удаление данных («право на забвение»)
- Консультация с юристом перед запуском монетизации через аналитику
- Соответствие ФЗ-152 при работе с персональными данными

## 7. План развития

| Этап | Цель | Ключевые метрики успеха |
|------|------|-------------------------|
| MVP | Подтверждение ценности продукта | 30% пользователей возвращаются через неделю |
| Рост | Формирование устойчивого дохода | 3% конверсия в премиум-подписку |
| Масштаб | Монетизация данных и аудитории | 5+ B2B-контрактов с туроператорами |

Критерий перехода на следующий этап — не количество пользователей, а качество взаимодействия: повторные сессии, глубина использования (среднее количество записей на пользователя), органический рост через рекомендации.

---

*Документ описывает концепцию продукта на уровне архитектуры и бизнес-логики. Техническая реализация должна учитывать ограничения платформы Телеграм и обеспечивать отказоустойчивость при работе с пользовательскими данными.*